<script>
  const codeBlocks = document.querySelectorAll('pre code.language-mermaid');
  if (codeBlocks.length > 0) {
    const { default: mermaid } = await import('mermaid');
    const isDark = document.documentElement.classList.contains('dark');
    mermaid.initialize({
      startOnLoad: false,
      theme: isDark ? 'dark' : 'default',
    });
    for (const block of codeBlocks) {
      const pre = block.parentElement;
      if (!pre) continue;
      const div = document.createElement('div');
      div.className = 'mermaid';
      div.textContent = block.textContent ?? '';
      pre.replaceWith(div);
    }
    await mermaid.run();
  }
</script>
